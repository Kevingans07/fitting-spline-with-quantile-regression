"0","```r
library(mgcv)

#1. Build spline model with smoothCon
spline_model <- smoothCon(s(x,k=10,bs=\"cr\"), data=data, knots=NULL)[[1]]
X <- spline_model$X
S <- spline_model$S[[1]] # penalty matrix S

#2. Define loss function with psi, lambda, sigma
pen_ssqr <- function(beta, X, y, S, 
                     lambda,tau, psi =0.1, sigma =1){
  mu <- X %*% beta
  res <- (y-mu)
  pen <- as.numeric(t(beta) %*% S %*% beta) #produces a 1x1 matrix
  
  #loss <- sum((y - mu)^2) + lambda * pen # this is for least square
  
  #smoothed pinball loss For Quantile Regression
  pinball_loss <- - sum((tau -plogis(res/psi))* res) 
  penalty <- lambda * pen
  return(pinball_loss+penalty)
}


```"
